<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ title or "modsuav" }}</title>
    <link href="/style.css" rel="stylesheet" />
  </head>

  <body class="min-h-screen flex flex-col bg-backdrop text-whisper font-sans antialiased">

    <!-- ✶ LOADER -->
    <div id="loader" class="fixed inset-0 z-50 bg-backdrop text-whisper flex flex-col items-center justify-center text-sm font-mono transition-opacity duration-1000 space-y-1 tracking-tight">
      <div class="text-suav animate-pulse">
        ✶ <span id="dot-sequence">.</span>
      </div>
      <div id="loader-message" class="opacity-70">initializing modsuav console</div>
    </div>

    <!-- ✶ AUDIO -->
    <audio id="boot-sound" preload="auto">
      <source src="/intro.mp3" type="audio/mpeg" />
    </audio>

    <!-- ✶ NAV -->
    {% include "nav.njk" %}

    <!-- ✶ CLICK MESSAGE -->
    <p id="click-message" class="text-xs text-center text-suav/60 mt-4 opacity-0 transition-opacity duration-500">
      ✶ connection verified
    </p>

    <!-- ✶ MAIN SLOT -->
    <main class="flex-1">
      {{ content | safe }}
    </main>

    <!-- ✶ FOOTER -->
    {% include "footer.njk" %}

    <!-- ✶ CONSOLE SCRIPT -->
    <script>
      const messages = [
        "initializing modsuav console",
        "linking to grove tree",
        "calibrating soul-interface",
        "establishing frequency sync",
        "syncing encrypted memory",
        "✶ ready"
      ];

      const bootSound = document.getElementById("boot-sound");

      bootSound?.play().catch((err) => {
        console.log("Autoplay blocked, will wait for user interaction:", err);
      });

      let hasUserClicked = false;

      window.addEventListener("click", () => {
        if (hasUserClicked) return;
        hasUserClicked = true;

        bootSound?.play().catch(err => {
          console.warn("Manual playback failed:", err);
        });

        const clickMessage = document.getElementById("click-message");
        if (clickMessage) {
          clickMessage.classList.remove("opacity-0");
          clickMessage.classList.add("opacity-100");

          setTimeout(() => {
            clickMessage.classList.remove("opacity-100");
            clickMessage.classList.add("opacity-0");
          }, 3500);
        }
      }, { once: true });

      if (!sessionStorage.getItem("modsuavLoaded")) {
        sessionStorage.setItem("modsuavLoaded", "true");

        let messageIndex = 0;
        const loaderMessage = document.getElementById("loader-message");
        const dotSequence = document.getElementById("dot-sequence");

        const dots = [".", "..", "..."];
        let dotState = 0;
        const dotTimer = setInterval(() => {
          dotState = (dotState + 1) % dots.length;
          dotSequence.textContent = dots[dotState];
        }, 300);

        const messageDelay = 500;
        const messageTimer = setInterval(() => {
          messageIndex++;
          if (messageIndex >= messages.length) {
            clearInterval(messageTimer);
            clearInterval(dotTimer);
            return;
          }
          loaderMessage.textContent = messages[messageIndex];
        }, messageDelay);

        setTimeout(() => {
          const loader = document.getElementById("loader");
          if (loader) {
            loader.classList.add("opacity-0");
            setTimeout(() => loader.remove(), 600);
          }
        }, messageDelay * (messages.length + 1));
      } else {
        document.getElementById("loader")?.remove();
      }
    </script>
  </body>
</html>




